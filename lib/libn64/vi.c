/* vi.c - Video Interface Functions */

#include <mips.h>
#include "vi.h"

/* Video register init codes. The order is:

   VI_STATUS_REG,    VI_H_WIDTH_REG,    VI_V_INTR_REG,
   VI_CURRENT_REG,   VI_TIMING_REG,     VI_V_SYNC_REG,    VI_H_SYNC_REG,
   VI_LEAP_REG,      VI_H_VIDEO_REG,    VI_V_VIDEO_REG,   VI_V_BURST_REG,
   VI_X_SCALE_REG,   VI_Y_SCALE_REG  

*/

u32 VI_NTSC_LPN1[] = {
  0x0000320e, 0x00000140, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020d, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002501ff, 0x000e0204,
  0x00000200, 0x00000400 } ;
u32 VI_PAL_LPN1[] = {
  0x0000320e, 0x00000140, 0x00000002,
  0x00000000, 0x0404233a, 0x00000271, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005f0239, 0x0009026b,
  0x00000200, 0x00000400 } ;
u32 VI_MPAL_LPN1[] = {
  0x0000320e, 0x00000140, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020d, 0x00040c11,
  0x0c190c1a, 0x006c02ec, 0x002501ff, 0x000e0204,
  0x00000200, 0x00000400 } ;

u32 VI_NTSC_LPF1[] = {
  0x0000324e, 0x00000140, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000200, 0x01000400 } ;
u32 VI_PAL_LPF1[] = {
  0x0000324e, 0x00000140, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000200, 0x01000400 } ;
u32 VI_MPAL_LPF1[] = {
  0x0000324e, 0x00000140, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000200, 0x01000400 } ;

u32 VI_NTSC_LAN1[] = {
  0x0000311e, 0x00000140, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020d, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002501ff, 0x000e0204,
  0x00000200, 0x00000400 } ;
u32 VI_PAL_LAN1[] = {
  0x0000311e, 0x00000140, 0x00000002,
  0x00000000, 0x0404233a, 0x00000271, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005f0239, 0x0009026b,
  0x00000200, 0x00000400 } ;
u32 VI_MPAL_LAN1[] = {
  0x0000311e, 0x00000140, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020d, 0x00040c11,
  0x0c190c1a, 0x006c02ec, 0x002501ff, 0x000e0204,
  0x00000200, 0x00000400 } ;

u32 VI_NTSC_LAF1[] = {
  0x0000305e, 0x00000140, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000200, 0x01000400 } ;
u32 VI_PAL_LAF1[] = {
  0x0000305e, 0x00000140, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000200, 0x01000400 } ;
u32 VI_MPAL_LAF1[] = {
  0x0000305e, 0x00000140, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000200, 0x01000400 } ;

u32 VI_NTSC_LPN2[] = {
  0x0000330f, 0x00000140, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020d, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002501ff, 0x000e0204,
  0x00000200, 0x00000400 } ;
u32 VI_PAL_LPN2[] = {
  0x0000330f, 0x00000140, 0x00000002,
  0x00000000, 0x0404233a, 0x00000271, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005f0239, 0x0009026b,
  0x00000200, 0x00000400 } ;
u32 VI_MPAL_LPN2[] = {
  0x0000330f, 0x00000140, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020d, 0x00040c11,
  0x0c190c1a, 0x006c02ec, 0x002501ff, 0x000e0204,
  0x00000200, 0x00000400 } ;

u32 VI_NTSC_LPF2[] = {
  0x0000324f, 0x00000140, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000200, 0x01000400 } ;
u32 VI_PAL_LPF2[] = {
  0x0000324f, 0x00000140, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000200, 0x01000400 } ;
u32 VI_MPAL_LPF2[] = {
  0x0000324f, 0x00000140, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000200, 0x01000400 } ;

u32 VI_NTSC_LAN2[] = {
  0x0000301f, 0x00000140, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020d, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002501ff, 0x000e0204,
  0x00000200, 0x00000400 } ;
u32 VI_PAL_LAN2[] = {
  0x0000301f, 0x00000140, 0x00000002,
  0x00000000, 0x0404233a, 0x00000271, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005f0239, 0x0009026b,
  0x00000200, 0x00000400 } ;
u32 VI_MPAL_LAN2[] = {
  0x0000301f, 0x00000140, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020d, 0x00040c11,
  0x0c190c1a, 0x006c02ec, 0x002501ff, 0x000e0204,
  0x00000200, 0x00000400 } ;

u32 VI_NTSC_LAF2[] = {
  0x0000305f, 0x00000140, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000200, 0x01000400 } ;
u32 VI_PAL_LAF2[] = {
  0x0000305f, 0x00000140, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000200, 0x01000400 } ;
u32 VI_MPAL_LAF2[] = {
  0x0000305f, 0x00000140, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000200, 0x01000400 } ;

u32 VI_NTSC_HPN1[] = {
  0x0000324e, 0x00000500, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000400, 0x00000400 } ;
u32 VI_PAL_HPN1[] = {
  0x0000324e, 0x00000500, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000400, 0x00000400 } ;
u32 VI_MPAL_HPN1[] = {
  0x0000324e, 0x00000500, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000400, 0x00000400 } ;

u32 VI_NTSC_HPF1[] = {
  0x0000324e, 0x00000280, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000400, 0x02000800 } ;
u32 VI_PAL_HPF1[] = {
  0x0000324e, 0x00000280, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000400, 0x02000800 } ;
u32 VI_MPAL_HPF1[] = {
  0x0000324e, 0x00000280, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000400, 0x02000800 } ;

u32 VI_NTSC_HAN1[] = {
  0x0000305e, 0x00000500, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000400, 0x00000400 } ;
u32 VI_PAL_HAN1[] = {
  0x0000305e, 0x00000500, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000400, 0x00000400 } ;
u32 VI_MPAL_HAN1[] = {
  0x0000305e, 0x00000500, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000400, 0x00000400 } ;

u32 VI_NTSC_HAF1[] = {
  0x0000305e, 0x00000280, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000400, 0x02000800 } ;
u32 VI_PAL_HAF1[] = {
  0x0000305e, 0x00000280, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000400, 0x02000800 } ;
u32 VI_MPAL_HAF1[] = {
  0x0000305e, 0x00000280, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000400, 0x02000800 } ;

u32 VI_NTSC_HPN2[] = {
  0x0000334f, 0x00000500, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000400, 0x00000400 } ;
u32 VI_PAL_HPN2[] = {
  0x0000334f, 0x00000500, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000400, 0x00000400 } ;
u32 VI_MPAL_HPN2[] = {
  0x0000334f, 0x00000500, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000400, 0x00000400 } ;

u32 VI_NTSC_HPF2[] = {
  0x0000324f, 0x00000280, 0x00000002,
  0x00000000, 0x03e52239, 0x0000020c, 0x00000c15,
  0x0c150c15, 0x006c02ec, 0x002301fd, 0x000e0204,
  0x00000400, 0x02000800 } ;
u32 VI_PAL_HPF2[] = {
  0x0000324f, 0x00000280, 0x00000002,
  0x00000000, 0x0404233a, 0x00000270, 0x00150c69,
  0x0c6f0c6e, 0x00800300, 0x005d0237, 0x0009026b,
  0x00000400, 0x02000800 } ;
u32 VI_MPAL_HPF2[] = {
  0x0000324f, 0x00000280, 0x00000002,
  0x00000000, 0x04651e39, 0x0000020c, 0x00000c10,
  0x0c1c0c1c, 0x006c02ec, 0x002301fd, 0x000b0202,
  0x00000400, 0x02000800 } ;

void initVideo(void *cfb,u32 *pal,u32 *ntsc,u32 *mpal)
{
  int i=0;
  u32 *mode,*ptr=(u32*)VI_BASE_REG;
  switch (tvType) {
  case TV_PAL: mode=pal;break;
  case TV_MPAL: mode=mpal;break;
  case TV_NTSC:
  default: mode=ntsc;break;
  }
  while (ptr<=(u32*)VI_Y_SCALE_REG) 
    if ((u32)ptr!=(u32)VI_DRAM_ADDR_REG) 
      IO_WRITE(ptr++,mode[i++]);
  else 
      IO_WRITE(ptr++,cfb);
}

void draw5050(u16 *cfb,u16 *sprite,int x,int y) {
  int a=0,b=0;
  for (b=0;b<=50;b++) 
    for (a=0;a<=50;a++) 
      cfb[(b+y)*320+x+a]=sprite[b*50+a];}

void drawBox(u16 *cfb,int x,int y,u16 colour) {
  int a,b;
  for (a=0;a<=y;a++)
    for (b=0;b<=x;b++)
      cfb[a*320+b]=colour;
}

// draw a sprite in cfb position x,y
void drawSprite(u16 *cfb,u16 *sprite,int x,int y) {
  int a,b;
  u16 *gfx;
  u16 w,h,pixel;
  w=sprite[0];
  h=sprite[1];
  gfx=&sprite[4];
  for (b=0;b<h;b++) 
    for (a=0;a<w;a++)
      {
	pixel=gfx[b*w+a];
        if (pixel&1) cfb[(b+y)*320+x+a]=pixel;
      }
}

void drawImage32(u32 *cfb,u32 *gfx,int x,int y,u16 w,u16 h) {
  int a,b;
  u32 pixel;
  for (b=0;b<h;b++)
    for (a=0;a<w;a++)
      {
	pixel=gfx[b*w+a];
        cfb[(b+y)*640+x+a]=pixel;
      }
}

